--- curl-7.14.0-orig/lib/escape.c	2005-03-30 23:02:03.000000000 -0800
+++ curl-7.14.0/lib/escape.c	2010-09-03 14:47:21.522766458 -0700
@@ -103,7 +103,7 @@
 
   while(--alloc > 0) {
     in = *string;
-    if(('%' == in) && ishex(string[1]) && ishex(string[2])) {
+    if(('%' == in) && (alloc > 2) && ishex(string[1]) && ishex(string[2])) {
       /* this is two hexadecimal digits following a '%' */
       char hexstr[3];
       char *ptr;
